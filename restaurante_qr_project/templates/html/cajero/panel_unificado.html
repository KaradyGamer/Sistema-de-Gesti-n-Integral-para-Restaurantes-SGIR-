{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Caja - Sistema Restaurante</title>
    <link rel="stylesheet" href="{% static 'css/cajero/panel_unificado.css' %}?v=36.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    {% csrf_token %}
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class='bx bx-restaurant'></i>
                <span>Sistema Caja</span>
            </div>
            <button class="toggle-btn" id="toggleSidebar">
                <i class='bx bx-menu'></i>
            </button>
        </div>

        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" data-section="dashboard">
                <i class='bx bx-home-alt'></i>
                <span>Inicio</span>
            </a>
            <a href="#mesas" class="nav-item" data-section="mesas">
                <i class='bx bx-map'></i>
                <span>Mapa de Mesas</span>
            </a>
            <a href="#historial" class="nav-item" data-section="historial">
                <i class='bx bx-history'></i>
                <span>Historial</span>
            </a>
            <a href="#stock" class="nav-item" data-section="stock">
                <i class='bx bx-package'></i>
                <span>Alertas Stock</span>
                <span class="badge warning" id="badgeStock">0</span>
            </a>
            <a href="#personal" class="nav-item" data-section="personal">
                <i class='bx bx-group'></i>
                <span>Personal</span>
            </a>
            <a href="#jornada" class="nav-item" data-section="jornada">
                <i class='bx bx-calendar'></i>
                <span>Jornada Laboral</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-info">
                <i class='bx bx-user-circle'></i>
                <div>
                    <strong>{{ nombre_usuario|default:"Cajero" }}</strong>
                    <small>{{ user_role|upper|default:"CAJERO" }}</small>
                </div>
            </div>
            <a href="/usuarios/logout/" class="logout-btn">
                <i class='bx bx-log-out'></i>
                <span>Cerrar Sesi√≥n</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <div class="topbar">
            <div class="topbar-left">
                <h1 id="pageTitle">Inicio</h1>
                <p id="pageSubtitle">Resumen general del sistema</p>
            </div>
            <div class="topbar-right">
                <!-- Estado de Turno -->
                <div class="turno-status" id="turnoStatus">
                    {% if turno_abierto %}
                    <span class="status-badge success">
                        <i class='bx bx-check-circle'></i>
                        Turno Abierto
                    </span>
                    <span class="turno-info">{{ turno_abierto.get_turno_display }} - {{ turno_abierto.hora_apertura|date:"H:i" }}</span>
                    {% else %}
                    <span class="status-badge danger">
                        <i class='bx bx-x-circle'></i>
                        Sin Turno
                    </span>
                    <button class="btn btn-primary btn-sm" onclick="abrirTurno()">Abrir Turno</button>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Content Sections -->
        <div class="content-area">
            <!-- SECCI√ìN: DASHBOARD -->
            <section id="section-dashboard" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card purple">
                        <div class="stat-icon">
                            <i class='bx bx-dollar-circle'></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ventas del D√≠a</h3>
                            <div class="stat-value">Bs/ <span id="totalVentas">0.00</span></div>
                        </div>
                    </div>
                    <div class="stat-card blue">
                        <div class="stat-icon">
                            <i class='bx bx-cart'></i>
                        </div>
                        <div class="stat-info">
                            <h3>Pedidos Totales</h3>
                            <div class="stat-value"><span id="totalPedidos">0</span></div>
                        </div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-icon">
                            <i class='bx bx-check'></i>
                        </div>
                        <div class="stat-info">
                            <h3>Pedidos Pagados</h3>
                            <div class="stat-value"><span id="pedidosPagados">0</span></div>
                        </div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-icon">
                            <i class='bx bx-time'></i>
                        </div>
                        <div class="stat-info">
                            <h3>Pendientes</h3>
                            <div class="stat-value"><span id="pedidosPendientes">0</span></div>
                        </div>
                    </div>
                </div>

                <!-- Gr√°fico y Acciones R√°pidas -->
                <div class="dashboard-grid">
                                        <div class="card" style="grid-column: span 2;">
                        <h2>üçΩÔ∏è Estado de Pedidos</h2>
                        <div id="kanbanBoard" class="kanban-board">
                            <div class="kanban-column" data-estado="pedido">
                                <div class="kanban-header pedido">
                                    <i class='bx bx-receipt'></i>
                                    <h3>PEDIDO</h3>
                                    <span class="count" id="count-pedido">0</span>
                                </div>
                                <div class="kanban-items" id="items-pedido">
                                    <div class="loading">Cargando...</div>
                                </div>
                            </div>
                            <div class="kanban-column" data-estado="preparando">
                                <div class="kanban-header preparando">
                                    <i class='bx bx-loader-alt'></i>
                                    <h3>PREPARANDO</h3>
                                    <span class="count" id="count-preparando">0</span>
                                </div>
                                <div class="kanban-items" id="items-preparando">
                                    <div class="loading">Cargando...</div>
                                </div>
                            </div>
                            <div class="kanban-column" data-estado="listo">
                                <div class="kanban-header listo">
                                    <i class='bx bx-check-circle'></i>
                                    <h3>LISTO</h3>
                                    <span class="count" id="count-listo">0</span>
                                </div>
                                <div class="kanban-items" id="items-listo">
                                    <div class="loading">Cargando...</div>
                                </div>
                            </div>
                            <div class="kanban-column" data-estado="entregado">
                                <div class="kanban-header entregado">
                                    <i class='bx bx-package'></i>
                                    <h3>ENTREGADO</h3>
                                    <span class="count" id="count-entregado">0</span>
                                </div>
                                <div class="kanban-items" id="items-entregado">
                                    <div class="loading">Cargando...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </section>

            <!-- SECCI√ìN: MAPA MESAS -->
            <section id="section-mesas" class="content-section">
                <div id="mapaMesasContainer" class="loading">Cargando mapa de mesas...</div>
            </section>

            <!-- SECCI√ìN: HISTORIAL -->
            <section id="section-historial" class="content-section">
                <h2>Historial de Transacciones</h2>
                <div id="historialContainer" class="loading">Cargando historial...</div>
            </section>

            <!-- SECCI√ìN: ALERTAS STOCK -->
            <section id="section-stock" class="content-section">
                <div id="alertasStockContainer" class="loading">Cargando alertas...</div>
            </section>

            <!-- SECCI√ìN: PERSONAL -->
            <section id="section-personal" class="content-section">
                <div id="personalContainer" class="loading">Cargando personal...</div>
            </section>

            <!-- SECCI√ìN: JORNADA LABORAL -->
            <section id="section-jornada" class="content-section">
                <div id="jornadaContainer" class="loading">Cargando jornada...</div>
            </section>
        </div>
    </div>

    <!-- Modal Detalle de Pedido -->
    <div id="modalDetallePedido" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Detalle del Pedido</h2>
                <button class="modal-close" onclick="cerrarModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Contenido din√°mico -->
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="{% static 'js/cajero/panel_unificado.js' %}?v=38.9"></script>
</body>
</html>
