{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abrir Caja - Sistema de Caja</title>
    <link rel="stylesheet" href="{% static 'css/cajero/abrir_caja.css' %}?v=10.0">
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <div class="icon">💰</div>
                <h1>Apertura de Caja</h1>
                <p>Registra el efectivo inicial para comenzar tu turno</p>
            </div>

            {% if error %}
            <div class="alert alert-danger">
                ⚠️ {{ error }}
            </div>
            {% endif %}

            {% if caja_abierta %}
            <div class="existing-cierre">
                <h3>⚠️ Ya existe una caja abierta</h3>
                <div class="detail-row">
                    <span><strong>Turno:</strong></span>
                    <span>{{ caja_abierta.get_turno_display }}</span>
                </div>
                <div class="detail-row">
                    <span><strong>Fecha de Apertura:</strong></span>
                    <span>{{ caja_abierta.fecha|date:"d/m/Y" }}</span>
                </div>
                <div class="detail-row">
                    <span><strong>Efectivo Inicial:</strong></span>
                    <span>Bs/ {{ caja_abierta.efectivo_inicial }}</span>
                </div>
                <div class="detail-row">
                    <span><strong>Total Ventas:</strong></span>
                    <span>Bs/ {{ caja_abierta.total_ventas }}</span>
                </div>
            </div>

            <div class="alert alert-info">
                ℹ️ Debes cerrar la caja actual antes de abrir una nueva.
            </div>

            <div class="buttons">
                <a href="{% url 'caja:cierre_caja' %}" class="btn btn-primary">📊 Ir a Cierre de Caja</a>
                <a href="/caja/" class="btn btn-secondary">← Volver al Panel</a>
            </div>

            {% else %}

            <div class="user-info-box">
                <div class="info-row">
                    <span class="label">Cajero:</span>
                    <span class="value">{{ request.user.get_full_name }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Fecha:</span>
                    <span class="value">{{ hoy|date:"d/m/Y" }}</span>
                </div>
                <div class="info-row">
                    <span class="label">Hora:</span>
                    <span class="value">{{ ahora|date:"H:i" }}</span>
                </div>
            </div>

            <form method="post" id="abrir-caja-form">
                {% csrf_token %}

                <div class="form-group">
                    <label for="turno">Selecciona el Turno:</label>
                    <select id="turno" name="turno" required>
                        <option value="">-- Seleccionar Turno --</option>
                        <option value="manana">🌅 Mañana (06:00 - 14:00)</option>
                        <option value="tarde">☀️ Tarde (14:00 - 22:00)</option>
                        <option value="noche">🌙 Noche (22:00 - 06:00)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="efectivo_inicial">Efectivo Inicial en Caja:</label>
                    <div class="hint">
                        💡 Ingresa el monto en efectivo con el que inicias tu turno
                    </div>
                    <div class="money-input">
                        <div class="currency">Bs/</div>
                        <input
                            type="number"
                            id="efectivo_inicial"
                            name="efectivo_inicial"
                            step="0.01"
                            min="0"
                            required
                            placeholder="0.00"
                        >
                    </div>
                </div>

                <div class="alert alert-info">
                    ℹ️ <strong>Importante:</strong> Verifica el efectivo antes de registrar la apertura. Este monto será la base para el cierre de caja.
                </div>

                <div class="buttons">
                    <button type="submit" class="btn btn-primary">
                        ✓ Abrir Caja
                    </button>
                    <a href="/caja/" class="btn btn-secondary">
                        Cancelar
                    </a>
                </div>
            </form>

            {% endif %}
        </div>
    </div>

    <script src="{% static 'js/cajero/abrir_caja.js' %}"></script>
</body>
</html>
