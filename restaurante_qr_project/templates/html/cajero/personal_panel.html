{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Personal - Sistema de Caja</title>
    <link rel="stylesheet" href="{% static 'css/cajero/personal_panel.css' %}?v=10.0">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üë• Gesti√≥n de Personal</h1>
            <div class="user-info">
                <span>Cajero: <strong>{{ request.user.get_full_name }}</strong></span>
                <a href="/caja/" class="btn btn-secondary">‚Üê Volver al Panel</a>
                <a href="/usuarios/logout/" class="btn btn-danger">Cerrar Sesi√≥n</a>
            </div>
        </div>

        <!-- Estad√≠sticas -->
        <div class="stats">
            <div class="stat-box">
                <div class="icon">üë•</div>
                <div class="number">{{ total_empleados }}</div>
                <div class="label">Total Empleados Activos</div>
            </div>
            <div class="stat-box">
                <div class="icon">üçΩÔ∏è</div>
                <div class="number">{{ meseros.count }}</div>
                <div class="label">Meseros</div>
            </div>
            <div class="stat-box">
                <div class="icon">üë®‚Äçüç≥</div>
                <div class="number">{{ cocineros.count }}</div>
                <div class="label">Cocineros</div>
            </div>
        </div>

        <!-- Meseros -->
        {% if meseros %}
        <div class="card">
            <h2>üçΩÔ∏è Meseros</h2>
            <div class="empleados-grid">
                {% for empleado in meseros %}
                <div class="empleado-card">
                    <div class="empleado-header">
                        <div class="empleado-avatar">
                            {{ empleado.first_name.0|upper }}{{ empleado.last_name.0|upper }}
                        </div>
                        <div class="empleado-info">
                            <div class="empleado-nombre">{{ empleado.get_full_name }}</div>
                            <div class="empleado-rol">üçΩÔ∏è {{ empleado.get_rol_display }}</div>
                        </div>
                    </div>

                    <div class="empleado-detalles">
                        <div class="detalle-item">
                            <span class="detalle-label">Usuario:</span>
                            <span class="detalle-value">{{ empleado.username }}</span>
                        </div>
                        <div class="detalle-item">
                            <span class="detalle-label">PIN:</span>
                            <span class="detalle-value">
                                {% if empleado.pin %}
                                    <span class="badge badge-success">‚úì Configurado</span>
                                {% else %}
                                    <span class="badge badge-warning">Sin PIN</span>
                                {% endif %}
                            </span>
                        </div>
                        <div class="detalle-item">
                            <span class="detalle-label">√Åreas:</span>
                            <span class="detalle-value">
                                {% for area in empleado.get_areas_activas %}
                                    {{ area }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                        </div>
                    </div>

                    <div class="empleado-actions">
                        <button class="btn btn-success" onclick="generarQR({{ empleado.id }}, '{{ empleado.get_full_name }}', '{{ empleado.get_rol_display }}')">
                            üì± Generar C√≥digo QR
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Cocineros -->
        {% if cocineros %}
        <div class="card">
            <h2>üë®‚Äçüç≥ Cocineros</h2>
            <div class="empleados-grid">
                {% for empleado in cocineros %}
                <div class="empleado-card">
                    <div class="empleado-header">
                        <div class="empleado-avatar">
                            {{ empleado.first_name.0|upper }}{{ empleado.last_name.0|upper }}
                        </div>
                        <div class="empleado-info">
                            <div class="empleado-nombre">{{ empleado.get_full_name }}</div>
                            <div class="empleado-rol">üë®‚Äçüç≥ {{ empleado.get_rol_display }}</div>
                        </div>
                    </div>

                    <div class="empleado-detalles">
                        <div class="detalle-item">
                            <span class="detalle-label">Usuario:</span>
                            <span class="detalle-value">{{ empleado.username }}</span>
                        </div>
                        <div class="detalle-item">
                            <span class="detalle-label">PIN:</span>
                            <span class="detalle-value">
                                {% if empleado.pin %}
                                    <span class="badge badge-success">‚úì Configurado</span>
                                {% else %}
                                    <span class="badge badge-warning">Sin PIN</span>
                                {% endif %}
                            </span>
                        </div>
                        <div class="detalle-item">
                            <span class="detalle-label">√Åreas:</span>
                            <span class="detalle-value">
                                {% for area in empleado.get_areas_activas %}
                                    {{ area }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                        </div>
                    </div>

                    <div class="empleado-actions">
                        <button class="btn btn-success" onclick="generarQR({{ empleado.id }}, '{{ empleado.get_full_name }}', '{{ empleado.get_rol_display }}')">
                            üì± Generar C√≥digo QR
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Sin empleados -->
        {% if not meseros and not cocineros %}
        <div class="card">
            <div class="no-empleados">
                <div class="icon">üë•</div>
                <h3>No hay empleados registrados</h3>
                <p>Contacta al administrador para crear cuentas de empleados</p>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Modal de QR -->
    <div class="modal" id="qrModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì± C√≥digo QR de Acceso</h3>
                <p id="empleado-nombre"></p>
            </div>

            <div class="qr-container" id="qr-container">
                <img id="qr-image" src="" alt="C√≥digo QR">
            </div>

            <div class="qr-info">
                <p><strong>Instrucciones:</strong></p>
                <p>1. El empleado debe escanear este c√≥digo QR con su celular</p>
                <p>2. Ser√° redirigido autom√°ticamente a su √°rea de trabajo</p>
                <p>3. El c√≥digo QR es √∫nico y permanente para este empleado</p>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="cerrarModal()">Cerrar</button>
                <button class="btn btn-primary" onclick="window.print()">üñ®Ô∏è Imprimir</button>
            </div>
        </div>
    </div>

    <script src="{% static 'js/cajero/personal_panel.js' %}"></script>
</body>
</html>
