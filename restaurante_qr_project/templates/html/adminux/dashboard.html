{% extends "html/adminux/base_adminux.html" %}
{% load static %}

{% block title %}Dashboard - AdminUX{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/adminux/dashboard-premium.css' %}">
{% endblock %}

{% block content %}
<div class="adminux-dashboard">
    <!-- CABECERA GRANDE -->
    <section class="dashboard-hero">
        <div class="hero-inner">
            <div class="hero-clock">
                <div id="dashboard-clock" class="hero-clock-digits">00 : 00 : 00</div>
                <div id="dashboard-date" class="hero-clock-date">---</div>
            </div>

            <div class="hero-period">
                <button class="period-btn period-btn-active" data-period="day">Hoy</button>
                <button class="period-btn" data-period="week">Semana</button>
                <button class="period-btn" data-period="month">Mes</button>
            </div>
        </div>
    </section>

    <!-- FILA DE GRÁFICAS -->
    <section class="charts-row">
        <div class="chart-card">
            <h3>Pedidos (últimos 7 días)</h3>
            <canvas id="ordersChart"></canvas>
        </div>

        <div class="chart-card">
            <h3>Ventas (últimos 7 días)</h3>
            <canvas id="salesChart"></canvas>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // =======================
    // RELOJ EN TIEMPO REAL
    // =======================
    function updateDashboardClock() {
        const clockEl = document.getElementById("dashboard-clock");
        const dateEl  = document.getElementById("dashboard-date");
        if (!clockEl || !dateEl) return;

        const now = new Date();

        const hh = String(now.getHours()).padStart(2, "0");
        const mm = String(now.getMinutes()).padStart(2, "0");
        const ss = String(now.getSeconds()).padStart(2, "0");
        clockEl.textContent = `${hh} : ${mm} : ${ss}`;

        const dias = ["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"];
        const meses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio",
                       "Agosto","Septiembre","Octubre","Noviembre","Diciembre"];

        const diaNombre = dias[now.getDay()];
        const diaNum    = now.getDate();
        const mesNombre = meses[now.getMonth()];
        const anio      = now.getFullYear();

        dateEl.textContent = `${diaNombre}, ${diaNum} de ${mesNombre} de ${anio}`;
    }

    setInterval(updateDashboardClock, 1000);
    updateDashboardClock();

    // =======================
    // TOGGLE HOY / SEMANA / MES (solo visual)
    // =======================
    document.querySelectorAll(".period-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            document.querySelectorAll(".period-btn").forEach(b => b.classList.remove("period-btn-active"));
            btn.classList.add("period-btn-active");
        });
    });

    // =======================
    // GRÁFICAS CHART.JS
    // =======================
    document.addEventListener("DOMContentLoaded", function () {
        const ordersCtx = document.getElementById("ordersChart").getContext("2d");
        const salesCtx  = document.getElementById("salesChart").getContext("2d");

        // Estos vienen desde la vista de Django
        const labels     = {{ chart_labels|safe }};
        const ordersData = {{ chart_orders|safe }};
        const salesData  = {{ chart_sales|safe }};

        // BARRAS - PEDIDOS
        new Chart(ordersCtx, {
            type: "bar",
            data: {
                labels: labels,
                datasets: [{
                    label: "Pedidos",
                    data: ordersData,
                    backgroundColor: "rgba(132, 176, 103, 0.7)",
                    borderRadius: 8,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: {
                        ticks: { color: "#cccccc" },
                        grid: { display: false }
                    },
                    y: {
                        ticks: { color: "#999999" },
                        grid: { color: "#222222" }
                    }
                }
            }
        });

        // LÍNEA - VENTAS
        new Chart(salesCtx, {
            type: "line",
            data: {
                labels: labels,
                datasets: [{
                    label: "Ventas",
                    data: salesData,
                    borderColor: "#84B067",
                    backgroundColor: "rgba(132, 176, 103, 0.25)",
                    tension: 0.35,
                    fill: true,
                    pointRadius: 3,
                    pointHoverRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: {
                        ticks: { color: "#cccccc" },
                        grid: { display: false }
                    },
                    y: {
                        ticks: { color: "#999999" },
                        grid: { color: "#222222" }
                    }
                }
            }
        });
    });
</script>
{% endblock %}
