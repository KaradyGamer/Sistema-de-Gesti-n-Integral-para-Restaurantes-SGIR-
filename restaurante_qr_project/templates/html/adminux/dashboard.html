{% extends "base.html" %}
{% block title %}Panel Administrativo{% endblock %}

{% block content %}
<div class="container">
  <div class="header">
    <div>
      <div class="h1">Panel Administrativo</div>
      <div class="p">Bienvenido, {{ user.get_full_name|default:user.username }}</div>
    </div>
    <div class="header-actions">
      {% if admin_home %}
      <a class="btn" href="{{ admin_home }}">Admin Django</a>
      {% endif %}
      <button class="toggle" onclick="toggleDark()">Modo Claro/Oscuro</button>
    </div>
  </div>

  <!-- KPIs -->
  <div class="grid grid-3" style="margin-top:18px">
    <!-- Mesas -->
    <div class="card">
      <div class="h2">Mesas</div>
      <div class="hr"></div>
      <div style="font-size:28px; font-weight:800">{{ kpis.mesas.total|default:0 }}</div>
      <div class="p">Total de mesas registradas</div>
      {% if kpis.mesas.disponibles %}
      <div style="margin-top:8px">
        <span class="badge"><span class="badge-dot"></span> <strong>{{ kpis.mesas.disponibles }}</strong> disponibles</span>
      </div>
      {% endif %}
      <div class="hr"></div>
      <a href="{{ kpis.mesas.admin_list|default:'#' }}">Ver todas</a>
      &nbsp;—&nbsp;<a href="{{ kpis.mesas.admin_add|default:'#' }}">+ Añadir</a>
    </div>

    <!-- Productos -->
    <div class="card">
      <div class="h2">Productos</div>
      <div class="hr"></div>
      <div style="font-size:28px; font-weight:800">{{ kpis.productos.total|default:0 }}</div>
      <div class="p">{{ kpis.productos.categorias|default:0 }} categorías</div>
      {% if kpis.productos.stock_bajo and kpis.productos.stock_bajo > 0 %}
      <div style="margin-top:8px">
        <span class="badge"><span class="badge-dot"></span> <strong>{{ kpis.productos.stock_bajo }}</strong> stock bajo</span>
      </div>
      {% endif %}
      <div class="hr"></div>
      <a href="{{ kpis.productos.admin_list|default:'#' }}">Ver todos</a>
      &nbsp;—&nbsp;<a href="{{ kpis.productos.admin_add|default:'#' }}">+ Añadir</a>
      &nbsp;—&nbsp;<a href="{{ kpis.productos.admin_categorias|default:'#' }}">Categorías</a>
    </div>

    <!-- Pedidos -->
    <div class="card">
      <div class="h2">Pedidos</div>
      <div class="hr"></div>
      <div style="font-size:28px; font-weight:800">{{ kpis.pedidos.total|default:0 }}</div>
      <div class="p">{{ kpis.pedidos.en_cocina|default:0 }} en cocina · {{ kpis.pedidos.listos|default:0 }} listos</div>
      {% if kpis.pedidos.pendientes and kpis.pedidos.pendientes > 0 %}
      <div style="margin-top:8px">
        <span class="badge"><span class="badge-dot"></span> <strong>{{ kpis.pedidos.pendientes }}</strong> pendientes</span>
      </div>
      {% endif %}
      <div class="hr"></div>
      <a href="{{ kpis.pedidos.admin_list|default:'#' }}">Ver todos</a>
      &nbsp;—&nbsp;<a href="{{ kpis.pedidos.admin_add|default:'#' }}">+ Añadir</a>
    </div>

    <!-- Caja -->
    <div class="card">
      <div class="h2">Caja</div>
      <div class="hr"></div>
      <div style="font-size:28px; font-weight:800">{{ kpis.caja.transacciones|default:0 }}</div>
      <div class="p">
        {{ kpis.caja.jornadas|default:0 }} jornadas · {{ kpis.caja.cierres|default:0 }} cierres
        {% if kpis.caja.jornada_activa %}
        <br><strong>Jornada abierta</strong>
        {% endif %}
      </div>
      {% if kpis.caja.alertas_stock and kpis.caja.alertas_stock > 0 %}
      <div style="margin-top:8px">
        <span class="badge"><span class="badge-dot"></span> <strong>{{ kpis.caja.alertas_stock }}</strong> alertas de stock</span>
      </div>
      {% endif %}
      <div class="hr"></div>
      {% if kpis.caja.jornadas_list and kpis.caja.jornadas_list != "#" %}
      <a href="{{ kpis.caja.jornadas_list }}">Jornadas</a>
      {% endif %}
      {% if kpis.caja.transacciones_list and kpis.caja.transacciones_list != "#" %}
      &nbsp;—&nbsp;<a href="{{ kpis.caja.transacciones_list }}">Transacciones</a>
      {% endif %}
      {% if kpis.caja.alertas_list and kpis.caja.alertas_list != "#" and kpis.caja.alertas_stock > 0 %}
      &nbsp;—&nbsp;<a href="{{ kpis.caja.alertas_list }}">Alertas</a>
      {% endif %}
      {% if kpis.caja.cierres_list and kpis.caja.cierres_list != "#" %}
      &nbsp;—&nbsp;<a href="{{ kpis.caja.cierres_list }}">Cierres</a>
      {% endif %}
    </div>

    <!-- Reservas -->
    <div class="card">
      <div class="h2">Reservas</div>
      <div class="hr"></div>
      <div style="font-size:28px; font-weight:800">{{ kpis.reservas.total|default:0 }}</div>
      <div class="p">Total de reservas</div>
      {% if kpis.reservas.activas and kpis.reservas.activas > 0 %}
      <div style="margin-top:8px">
        <span class="badge"><span class="badge-dot"></span> <strong>{{ kpis.reservas.activas }}</strong> activas</span>
      </div>
      {% endif %}
      <div class="hr"></div>
      <a href="{{ kpis.reservas.admin_list|default:'#' }}">Ver todas</a>
      &nbsp;—&nbsp;<a href="{{ kpis.reservas.admin_add|default:'#' }}">+ Añadir</a>
    </div>

    <!-- Usuarios -->
    <div class="card">
      <div class="h2">Usuarios</div>
      <div class="hr"></div>
      <div style="font-size:28px; font-weight:800">{{ kpis.usuarios.total|default:0 }}</div>
      <div class="p">Total de usuarios del sistema</div>
      {% if kpis.usuarios.activos and kpis.usuarios.activos > 0 %}
      <div style="margin-top:8px">
        <span class="badge"><span class="badge-dot"></span> <strong>{{ kpis.usuarios.activos }}</strong> activos</span>
      </div>
      {% endif %}
      <div class="hr"></div>
      <a href="{{ kpis.usuarios.admin_list|default:'#' }}">Ver todos</a>
      &nbsp;—&nbsp;<a href="{{ kpis.usuarios.admin_add|default:'#' }}">+ Añadir</a>
    </div>
  </div>

  <!-- Listas recientes -->
  <div class="grid grid-3" style="margin-top:24px">
    <div class="card">
      <div class="h2">Pedidos recientes</div>
      <div class="hr"></div>
      <div class="list">
        {% for p in recientes.pedidos %}
        <div class="list-item">
          <span class="dot"></span>
          <div>#{{ p.id }} <span class="p">· {{ p.estado|title }}</span></div>
          <a style="margin-left:auto" href="{{ kpis.pedidos.admin_list|default:'#' }}">ver →</a>
        </div>
        {% empty %}
        <div class="p">Sin pedidos recientes</div>
        {% endfor %}
      </div>
    </div>

    <div class="card">
      <div class="h2">Transacciones recientes</div>
      <div class="hr"></div>
      <div class="list">
        {% for t in recientes.transacciones %}
        <div class="list-item">
          <span class="dot"></span>
          <div>#{{ t.id }} <span class="p">· Bs/{{ t.monto|floatformat:2 }}</span></div>
          <a style="margin-left:auto" href="{{ kpis.caja.admin_trans|default:'#' }}">ver →</a>
        </div>
        {% empty %}
        <div class="p">Sin transacciones recientes</div>
        {% endfor %}
      </div>
    </div>

    <div class="card">
      <div class="h2">Reservas recientes</div>
      <div class="hr"></div>
      <div class="list">
        {% for r in recientes.reservas %}
        <div class="list-item">
          <span class="dot"></span>
          <div>#{{ r.id }} <span class="p">· {{ r.nombre_cliente|truncatechars:15 }}</span></div>
          <a style="margin-left:auto" href="{{ kpis.reservas.admin_list|default:'#' }}">ver →</a>
        </div>
        {% empty %}
        <div class="p">Sin reservas recientes</div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
