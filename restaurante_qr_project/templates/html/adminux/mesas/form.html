{% extends 'html/adminux/base_form.html' %}

{% block title %}{% if mesa %}Editar Mesa{% else %}Nueva Mesa{% endif %}{% endblock %}
{% block page_title %}{% if mesa %}Editar Mesa{% else %}Crear Nueva Mesa{% endif %}{% endblock %}
{% block page_description %}{% if mesa %}Modifique los datos de la mesa{% else %}Complete el formulario para crear una nueva mesa{% endif %}{% endblock %}

{% block breadcrumb %}
<span>Mesas</span>
<span>/</span>
<span>{% if mesa %}Editar{% else %}Nueva{% endif %}</span>
{% endblock %}

{% block back_url %}{% url 'adminux:mesas' %}{% endblock %}
{% block cancel_url %}{% url 'adminux:mesas' %}{% endblock %}

{% block form_content %}
<div class="form-grid">
    <div class="form-group">
        <label for="numero" class="required">Número de Mesa</label>
        <input type="number" id="numero" name="numero" class="form-control"
               value="{{ mesa.numero|default:'' }}" min="1" required
               {% if mesa %}readonly{% endif %}>
        <small class="form-text">Número único de identificación de la mesa</small>
    </div>

    <div class="form-group">
        <label for="capacidad" class="required">Capacidad</label>
        <input type="number" id="capacidad" name="capacidad" class="form-control"
               value="{{ mesa.capacidad|default:'4' }}" min="1" max="20" required>
        <small class="form-text">Número de personas que puede acomodar</small>
    </div>

    <div class="form-group">
        <label for="estado" class="required">Estado</label>
        <select id="estado" name="estado" class="form-select" required>
            <option value="disponible" {% if mesa.estado == 'disponible' or not mesa %}selected{% endif %}>Disponible</option>
            <option value="ocupada" {% if mesa.estado == 'ocupada' %}selected{% endif %}>Ocupada</option>
            <option value="reservada" {% if mesa.estado == 'reservada' %}selected{% endif %}>Reservada</option>
        </select>
    </div>

    <div class="form-group">
        <label for="ubicacion">Ubicación</label>
        <input type="text" id="ubicacion" name="ubicacion" class="form-control"
               value="{{ mesa.ubicacion|default:'' }}" placeholder="Ej: Terraza, Salón principal">
        <small class="form-text">Ubicación física de la mesa en el restaurante</small>
    </div>
</div>

{% if mesa %}
<div class="form-section">
    <h3>Código QR</h3>
    {% if mesa.qr_code %}
    <div class="qr-preview">
        <img src="{{ mesa.qr_code.url }}" alt="QR Mesa {{ mesa.numero }}" style="max-width: 200px;">
        <p class="text-muted mt-2">El código QR permite a los clientes acceder al menú desde esta mesa</p>
    </div>
    {% else %}
    <p class="text-muted">Esta mesa no tiene código QR generado.</p>
    <button type="button" class="btn btn-secondary" onclick="generarQR()">
        <i class='bx bx-qr'></i> Generar Código QR
    </button>
    {% endif %}
</div>

{% if mesa.pedido_actual %}
<div class="form-section">
    <h3>Pedido Actual</h3>
    <div class="alert alert-info">
        <i class='bx bx-info-circle'></i>
        Esta mesa tiene un pedido activo:
        <a href="{% url 'adminux:pedido_detalle' mesa.pedido_actual.id %}" class="alert-link">
            Pedido #{{ mesa.pedido_actual.id }}
        </a>
    </div>
</div>
{% endif %}
{% endif %}
{% endblock %}

{% block extra_js %}
{% if mesa %}
<script>
function generarQR() {
    if (confirm('¿Desea generar un nuevo código QR para esta mesa?')) {
        window.adminUX.mostrarNotificacion('Generando código QR...', 'info');
        // Aquí iría la lógica para regenerar el QR
        setTimeout(() => {
            window.adminUX.mostrarNotificacion('Código QR generado exitosamente', 'success');
            location.reload();
        }, 1500);
    }
}
</script>
{% endif %}
{% endblock %}
