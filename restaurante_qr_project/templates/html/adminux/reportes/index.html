{% extends 'html/adminux/base_adminux.html' %}
{% load static %}

{% block title %}Reportes - AdminUX{% endblock %}

{% block extra_head %}
<style>
/* Estilos específicos para reportes */
.report-modo-toggle {
    display: flex;
    gap: 0.5rem;
}

.rep-modo-btn {
    padding: 0.5rem 1rem;
    border: 1px solid var(--border-subtle);
    background: var(--bg-elevated-soft);
    color: var(--text-muted);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.85rem;
    font-weight: 500;
}

.rep-modo-btn:hover {
    background: var(--bg-elevated);
    color: var(--text-main);
}

.rep-modo-btn.active {
    background: var(--accent);
    color: #000;
    border-color: var(--accent);
    font-weight: 600;
}

.report-master-grid {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 1.5rem;
    margin-top: 1.5rem;
}

.report-days-panel {
    background: var(--bg-elevated-soft);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid var(--border-subtle);
    max-height: 600px;
    overflow-y: auto;
}

.report-detail-panel {
    background: var(--bg-elevated-soft);
    border-radius: 8px;
    padding: 1.5rem;
    border: 1px solid var(--border-subtle);
}

.report-detail-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-subtle);
}

.report-section-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-main);
    margin: 0;
}

.report-detail-date-label {
    font-size: 0.9rem;
    color: var(--text-muted);
    padding: 0.4rem 0.8rem;
    background: rgba(132, 176, 103, 0.1);
    border-radius: 6px;
}

.report-main-chart {
    margin-bottom: 2rem;
}

.chart-canvas {
    width: 100% !important;
    height: 300px !important;
}

.report-detail-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.report-box {
    background: var(--bg-main);
    border: 1px solid var(--border-subtle);
    border-radius: 8px;
    padding: 1.25rem;
}

.report-box h4 {
    margin-bottom: 1rem;
}

.report-data-list {
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.report-data-list div {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-subtle);
}

.report-data-list div:last-child {
    border-bottom: none;
}

.report-data-list dt {
    font-size: 0.85rem;
    color: var(--text-muted);
    font-weight: 500;
}

.report-data-list dd {
    font-size: 0.9rem;
    color: var(--text-main);
    font-weight: 600;
    margin: 0;
}

.activity-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.activity-item {
    padding: 0.75rem;
    background: var(--bg-main);
    border-radius: 6px;
    border: 1px solid var(--border-subtle);
    cursor: pointer;
    transition: all 0.2s;
}

.activity-item:hover {
    background: var(--bg-elevated);
    border-color: var(--accent);
}

.activity-item.active {
    background: rgba(132, 176, 103, 0.15);
    border-color: var(--accent);
}

.activity-item-title {
    font-weight: 600;
    color: var(--text-main);
    display: block;
    margin-bottom: 0.25rem;
    font-size: 0.9rem;
}

.activity-item-meta {
    color: var(--text-muted);
    font-size: 0.75rem;
}

@media (max-width: 1024px) {
    .report-master-grid {
        grid-template-columns: 1fr;
    }

    .report-detail-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block adminux_page %}
<section class="page-section">
  <header class="page-header">
    <div>
      <h2>Reportes</h2>
      <p class="page-subtitle">Historial de días y detalle de ventas por día.</p>
    </div>
  </header>

  <article class="card">
    <div class="card-header-row">
      <h3>Días con movimientos</h3>

      <div class="report-modo-toggle">
        <button type="button" id="repModoDia" class="rep-modo-btn active">
          Día
        </button>
        <button type="button" id="repModoMes" class="rep-modo-btn">
          Mes
        </button>
        <button type="button" id="repModoAnio" class="rep-modo-btn">
          Año
        </button>
      </div>
    </div>

    <div class="card-body report-master-grid">
      <!-- COLUMNA IZQUIERDA: LISTA DE DÍAS -->
      <div class="report-days-panel">
        <ul id="repFechasLista" class="activity-list">
          <li class="activity-item active">
            <span class="activity-item-title">30 de Enero, 2025</span>
            <span class="activity-item-meta">Bs 4,250.00 • 23 tickets</span>
          </li>
          <li class="activity-item">
            <span class="activity-item-title">29 de Enero, 2025</span>
            <span class="activity-item-meta">Bs 3,890.00 • 19 tickets</span>
          </li>
          <li class="activity-item">
            <span class="activity-item-title">28 de Enero, 2025</span>
            <span class="activity-item-meta">Bs 5,120.00 • 27 tickets</span>
          </li>
        </ul>
      </div>

      <!-- COLUMNA DERECHA: DETALLE DEL DÍA -->
      <div class="report-detail-panel" id="repDetalleCard">
        <div class="report-detail-header">
          <h3 class="report-section-title">Detalle del día</h3>
          <span id="repDetalleFechaLabel" class="report-detail-date-label">
            30 de Enero, 2025
          </span>
        </div>

        <div class="report-detail">
          <!-- GRÁFICO POR HORA -->
          <div class="report-main-chart">
            <h4 class="report-section-title">Gráfico por hora</h4>
            <canvas id="repGraficoHoraCanvas" class="chart-canvas"></canvas>
          </div>

          <!-- FILA: DATOS + TOP PRODUCTOS -->
          <div class="report-detail-grid">
            <article class="report-box">
              <h4 class="report-section-title">Datos de caja</h4>
              <dl class="report-data-list">
                <div>
                  <dt>Caja al abrir</dt>
                  <dd id="repCajaInicio">Bs 500.00</dd>
                </div>
                <div>
                  <dt>Caja al cerrar</dt>
                  <dd id="repCajaCierre">Bs 4,750.00</dd>
                </div>
                <div>
                  <dt>Diferencia</dt>
                  <dd id="repCajaDiferencia">Bs 4,250.00</dd>
                </div>
                <div>
                  <dt>Ventas del día</dt>
                  <dd id="repVentasDia">Bs 4,250.00</dd>
                </div>
                <div>
                  <dt>Tickets del día</dt>
                  <dd id="repTicketsDia">23 tickets</dd>
                </div>
              </dl>
            </article>

            <article class="report-box">
              <h4 class="report-section-title">Top productos (top 10)</h4>
              <ul id="repTopProductosLista" class="activity-list">
                <li class="activity-item">
                  <span class="activity-item-title">Pizza Margherita</span>
                  <span class="activity-item-meta">12 unidades • Bs 840.00</span>
                </li>
                <li class="activity-item">
                  <span class="activity-item-title">Hamburguesa Clásica</span>
                  <span class="activity-item-meta">8 unidades • Bs 560.00</span>
                </li>
                <li class="activity-item">
                  <span class="activity-item-title">Coca Cola</span>
                  <span class="activity-item-meta">15 unidades • Bs 225.00</span>
                </li>
              </ul>
            </article>
          </div>

          <!-- LISTA COMPLETA DE PRODUCTOS DEL DÍA -->
          <article class="report-box" style="margin-top:1.5rem;">
            <h4 class="report-section-title">
              Lista de productos vendidos
            </h4>
            <ul id="repProductosDetalleLista" class="activity-list">
              <li class="activity-item">
                <span class="activity-item-title">Pizza Margherita</span>
                <span class="activity-item-meta">12 unidades • Bs 70.00 c/u • Total: Bs 840.00</span>
              </li>
              <li class="activity-item">
                <span class="activity-item-title">Hamburguesa Clásica</span>
                <span class="activity-item-meta">8 unidades • Bs 70.00 c/u • Total: Bs 560.00</span>
              </li>
              <li class="activity-item">
                <span class="activity-item-title">Coca Cola</span>
                <span class="activity-item-meta">15 unidades • Bs 15.00 c/u • Total: Bs 225.00</span>
              </li>
            </ul>
          </article>
        </div>
      </div>
    </div>
  </article>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ===== BOTONES DE MODO =====
document.querySelectorAll('.rep-modo-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.rep-modo-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        console.log('Modo seleccionado:', this.id);
        // Aquí puedes agregar lógica para cambiar el período
    });
});

// ===== LISTA DE DÍAS =====
document.querySelectorAll('.report-days-panel .activity-item').forEach(item => {
    item.addEventListener('click', function() {
        document.querySelectorAll('.report-days-panel .activity-item').forEach(i => i.classList.remove('active'));
        this.classList.add('active');
        // Aquí puedes agregar lógica para cargar datos del día seleccionado
    });
});

// ===== GRÁFICO DE VENTAS POR HORA =====
const ctx = document.getElementById('repGraficoHoraCanvas');
if (ctx) {
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00'],
            datasets: [{
                label: 'Ventas (Bs)',
                data: [120, 250, 180, 320, 450, 520, 380, 290, 340, 410, 390, 480, 350, 270],
                backgroundColor: 'rgba(132, 176, 103, 0.8)',
                borderColor: 'rgba(132, 176, 103, 1)',
                borderWidth: 1,
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    padding: 12,
                    titleColor: '#fff',
                    bodyColor: '#fff',
                    borderColor: '#84b067',
                    borderWidth: 1
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255,255,255,0.05)'
                    },
                    ticks: {
                        color: '#9ca3af'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#9ca3af'
                    }
                }
            }
        }
    });
}
</script>
{% endblock %}
