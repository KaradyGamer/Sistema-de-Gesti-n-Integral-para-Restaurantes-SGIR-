{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alertas de Stock - Sistema de Caja</title>
    <link rel="stylesheet" href="{% static 'css/cajero/alertas_stock.css' %}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö†Ô∏è Alertas de Stock</h1>
            <div class="user-info">
                <span>Cajero: <strong>{{ request.user.get_full_name }}</strong></span>
                <a href="/caja/" class="btn btn-secondary">‚Üê Volver</a>
                <a href="/usuarios/logout/" class="btn btn-danger">Cerrar Sesi√≥n</a>
            </div>
        </div>

        <div class="refresh-info">
            ‚ÑπÔ∏è Esta p√°gina se actualiza autom√°ticamente cada 60 segundos
        </div>

        <!-- Estad√≠sticas -->
        <div class="stats">
            <div class="stat-box critical">
                <div class="icon">üö®</div>
                <div class="number">{{ stats.agotados }}</div>
                <div class="label">Productos Agotados</div>
            </div>
            <div class="stat-box warning">
                <div class="icon">‚ö†Ô∏è</div>
                <div class="number">{{ stats.bajo_stock }}</div>
                <div class="label">Stock Bajo</div>
            </div>
            <div class="stat-box">
                <div class="icon">üì¶</div>
                <div class="number">{{ stats.total_alertas }}</div>
                <div class="label">Total Alertas Activas</div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="card">
            <div class="filters">
                <label for="filtro-tipo">Filtrar por:</label>
                <select id="filtro-tipo" onchange="filtrarAlertas()">
                    <option value="todas">Todas las Alertas</option>
                    <option value="agotado">Solo Agotados</option>
                    <option value="bajo_stock">Solo Stock Bajo</option>
                </select>
            </div>
        </div>

        <!-- Alertas de Productos Agotados -->
        {% if alertas_agotadas %}
        <div class="card">
            <h2>üö® Productos Agotados</h2>
            {% for alerta in alertas_agotadas %}
            <div class="alert alert-agotado" data-tipo="agotado">
                <div class="alert-icon">‚ùå</div>
                <div class="alert-content">
                    <div class="alert-title">{{ alerta.producto.nombre }}</div>
                    <div class="alert-details">
                        <strong>Categor√≠a:</strong> {{ alerta.producto.categoria.nombre }}
                        <br>
                        <strong>√öltima actualizaci√≥n:</strong> {{ alerta.fecha_creacion|date:"d/m/Y H:i" }}
                        <br>
                        <strong>Stock m√≠nimo requerido:</strong> {{ alerta.producto.stock_minimo }} unidades
                    </div>
                    <div class="stock-progress">
                        <div class="stock-progress-bar critical" style="width: 0%"></div>
                    </div>
                </div>
                <div class="alert-stock">
                    0<br>
                    <small style="font-size: 12px;">unidades</small>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Alertas de Stock Bajo -->
        {% if alertas_bajo_stock %}
        <div class="card">
            <h2>‚ö†Ô∏è Productos con Stock Bajo</h2>
            {% for alerta in alertas_bajo_stock %}
            <div class="alert alert-bajo" data-tipo="bajo_stock">
                <div class="alert-icon">‚ö†Ô∏è</div>
                <div class="alert-content">
                    <div class="alert-title">{{ alerta.producto.nombre }}</div>
                    <div class="alert-details">
                        <strong>Categor√≠a:</strong> {{ alerta.producto.categoria.nombre }}
                        <br>
                        <strong>Precio:</strong> Bs/ {{ alerta.producto.precio }}
                        <br>
                        <strong>Stock m√≠nimo:</strong> {{ alerta.producto.stock_minimo }} unidades
                        <br>
                        <strong>√öltima actualizaci√≥n:</strong> {{ alerta.fecha_creacion|date:"d/m/Y H:i" }}
                    </div>
                    <div class="stock-progress">
                        {% widthratio alerta.stock_actual alerta.producto.stock_minimo 100 as porcentaje %}
                        <div class="stock-progress-bar warning" style="width: {{ porcentaje }}%"></div>
                    </div>
                </div>
                <div class="alert-stock">
                    {{ alerta.stock_actual }}<br>
                    <small style="font-size: 12px;">unidades</small>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Sin Alertas -->
        {% if not alertas_agotadas and not alertas_bajo_stock %}
        <div class="card">
            <div class="no-alerts">
                <div class="icon">‚úÖ</div>
                <h3>¬°Todo en orden!</h3>
                <p>No hay alertas de stock en este momento</p>
            </div>
        </div>
        {% endif %}

        <!-- Informaci√≥n Adicional -->
        <div class="card">
            <h2>‚ÑπÔ∏è Informaci√≥n</h2>
            <p style="color: #666; line-height: 1.6;">
                <strong>¬øQu√© significan las alertas?</strong><br><br>
                üö® <strong>Agotado:</strong> El producto ya no tiene stock disponible. No se puede incluir en nuevos pedidos.<br><br>
                ‚ö†Ô∏è <strong>Stock Bajo:</strong> El stock actual est√° por debajo del m√≠nimo establecido. Es recomendable reabastecer pronto.<br><br>
                üí° <strong>Tip:</strong> Comunica estas alertas al gerente o administrador para gestionar el reabastecimiento.
            </p>
        </div>
    </div>

    <script src="{% static 'js/cajero/alertas_stock.js' %}"></script>
</body>
</html>
